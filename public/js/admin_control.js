// Generated by CoffeeScript 1.3.3
(function() {

  $(function($) {
    var checkAuthenticate, createLoginForm, createUploadForm;
    window.upImage = function(collectionName, imageURL, successCB) {
      return $.post('/up', {
        collectionName: collectionName,
        imageURL: imageURL
      }, successCB);
    };
    window.downImage = function(collectionName, imageURL, successCB) {
      return $.post('/down', {
        collectionName: collectionName,
        imageURL: imageURL
      }, successCB);
    };
    window.changeDescription = function(collectionName, description, successCB) {
      return $.post('/collectionDescription', {
        collectionName: collectionName,
        description: description
      }, successCB);
    };
    window.changeType = function(collectionName, type, successCB) {
      return $.post('/collectionType', {
        collectionName: collectionName,
        type: type
      }, successCB);
    };
    window.getCollectionType = function() {
      return window.location.href.split('=')[1];
    };
    window.uploadForm = function($fileForm) {
      var formData;
      formData = new FormData($fileForm[0]);
      return $.ajax({
        url: '/upload',
        type: 'POST',
        xhr: function() {
          var myXhr;
          myXhr = $.ajaxSettings.xhr();
          return myXhr;
        },
        data: formData,
        cache: false,
        contentType: false,
        processData: false
      });
    };
    (checkAuthenticate = function() {
      window.isAdmin = false;
      return $.get('/login', function(data) {
        if (!data.user) {
          return;
        }
        window.isAdmin = true;
        $('.admin-control').removeClass('admin-control');
        $('#login').hide();
        return $('#logout').show();
      });
    })();
    (createUploadForm = function() {
      var $addFileForm;
      $addFileForm = $('<form enctype="multipart/form-data" method="post">' + '<input type="file" name="upload" multiple="multiple" class="file">' + '<input type="text" name="name" class="file">' + '<input type="text" name="type" class="file">' + '</form>');
      $('.footer').append($addFileForm);
      return $('#new-collection-add').click(function() {
        var $cNameInput, $fileInput, $typeInput;
        $fileInput = $addFileForm.find('input[type=file]').val("");
        $cNameInput = $addFileForm.find('input[name=name]').val("");
        $typeInput = $addFileForm.find('input[name=type]').val(getCollectionType());
        $fileInput.change(function() {
          $fileInput.unbind();
          if ($fileInput.val() !== "") {
            return uploadForm($addFileForm);
          }
        });
        return $fileInput.click();
      });
    })();
    return (createLoginForm = function() {
      var $loginDialogBox;
      $loginDialogBox = $('#login-dialog').tmpl();
      return $('#login').click(function() {
        return $loginDialogBox.dialog({
          dialogClass: "login-form-dialog",
          buttons: {
            "Ok": function() {
              var formData;
              formData = new FormData();
              formData.append('username', $('#username').val());
              formData.append('password', $('#password').val());
              return $.ajax({
                url: '/login',
                type: 'POST',
                data: formData,
                error: function() {
                  return $loginDialogBox.dialog("widget").effect("shake", {
                    times: 3
                  }, 333);
                },
                success: function() {
                  return window.location.replace('/');
                },
                cache: false,
                contentType: false,
                processData: false
              });
            },
            "Cancel": function() {
              return $loginDialogBox.dialog("close");
            }
          }
        });
      });
    })();
  });

}).call(this);
