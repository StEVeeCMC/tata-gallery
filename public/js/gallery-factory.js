// Generated by CoffeeScript 1.3.3
(function() {

  define(['gallery', 'admin.controller', 'jquery', 'jquery.tmpl'], function(createGallery, adminController, $) {
    var GalleryFactory;
    GalleryFactory = (function() {

      function GalleryFactory(contentHolder, galleryTmpl, galleryType) {
        this.contentHolder = contentHolder;
        this.galleryTmpl = galleryTmpl;
        this.galleryType = galleryType;
      }

      GalleryFactory.prototype.createGallery = function() {
        var _this = this;
        $.get('/struct', function(collections) {
          return _this.appendNextCollection(collections);
        });
        return this;
      };

      GalleryFactory.prototype.appendNextCollection = function(collections) {
        var $gallery, collection, imagesCollection,
          _this = this;
        if (collections.length === 0) {
          return;
        }
        collection = collections.pop();
        if (collection.type === this.galleryType) {
          imagesCollection = [];
          collection.images.forEach(function(image) {
            return imagesCollection.push({
              dataLarge: 'img/all/' + image.imageURL,
              dataThumb: 'img/all/thumbs/' + image.thumbURL,
              collectionName: collection.name,
              fileName: image.imageURL
            });
          });
          $gallery = this.galleryTmpl.tmpl({
            description: collection.description,
            imagesCollection: imagesCollection
          }).appendTo(this.contentHolder);
          $gallery.bind("firstImageIsReady", function() {
            return _this.appendNextCollection(collections);
          });
          return createGallery($gallery, collection);
        } else {
          return this.appendNextCollection(collections);
        }
      };

      return GalleryFactory;

    })();
    if (!window.galleryFactory) {
      window.galleryFactory = new GalleryFactory($('div.content'), $('#rg-gallery-tmpl'), adminController.getCollectionType());
    }
    return window.galleryFactory;
  });

}).call(this);
